#include "em_device.h"
#include "em_chip.h"
#include "em_gpio.h"
#include "em_cmu.h"
#include "em_i2c.h"
#include "em_emu.h"
#include "em_rtc.h"
#include "em_cmu.h"

#include "uart_connection.h"
#include "i2c_connection.h"
#include "HM11.h"

//-------------INIT--------------
void initOscillators(void){
	CMU_ClockEnable(cmuClock_HFPER, true);
	CMU_ClockEnable(cmuClock_GPIO, true);     // enable GPIO peripheral clock
}

void testWait(){
	for (int i=0;i<10;i++){
		unsigned int counter=0;
		while (counter<1000000) {counter++;__asm("NOP");};
	}
}

//-------------MAIN-------------
int main(void)
{
  CHIP_Init();
  initOscillators();

  //initI2C();
  initUART();

  while(1){
	  if (initHM11()==0){	//initialization ok
		  GPIO_PinOutSet(gpioPortC, 1);
		  GPIO_PinOutClear(gpioPortC, 0);
	  }
	  else {	//test failed
		  GPIO_PinOutSet(gpioPortC, 0);
		  GPIO_PinOutClear(gpioPortC, 1);
	  }
	  uart_sendText("Test message\n");
	  testWait();

  }
}
